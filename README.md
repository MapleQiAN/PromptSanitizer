# PromptSanitizer

一个开源、开箱即用的桌面应用，用于在将 Prompt 发送给 LLM 之前，一键扫描并清洗敏感信息。

> 💡 **核心定位**：本工具不仅面向开发者，更重要的是为**日常用户**设计。在将内容粘贴到 ChatGPT、Claude、文心一言等网页 LLM 之前，先用本工具清洗一遍，避免把身份证号、Token、客户数据、公司机密等敏感信息一股脑粘进去。

## 特性

- 🔒 **本地优先**：完全离线运行，不上传任何内容
- 📊 **可解释**：提供详细的清洗报告，说明命中了什么、为什么、如何替换
- ⚡ **轻量快速**：处理 50k 字符文本 < 1 秒
- 🎯 **精准识别**：支持手机号、邮箱、身份证、IP、域名、Token、密码、私钥等多种敏感信息
- 🛡️ **灵活配置**：支持多种清洗策略、强度级别、类别开关、白名单
- 📈 **风险评分**：提供 0-100 的风险评分和详细统计

## 技术栈

- **前端**：TypeScript + Vue 3 (通过 Tauri)
- **桌面框架**：Tauri 2
- **核心引擎**：Go (sidecar 模式)
- **通信协议**：JSON over stdin/stdout

## 快速开始

### 开发环境要求

- Node.js 18+
- Rust 1.70+
- Go 1.21+
- Tauri CLI: `npm install -g @tauri-apps/cli`

### 本地开发

```bash
# 安装依赖
npm install

# 构建 Go 引擎
cd engine/go
go build -o ../../apps/tauri/src-tauri/bin/prompt-sanitizer.exe ./cmd/main.go

# 开发模式运行
cd ../../apps/tauri
npm run tauri dev
```

### 打包

```bash
cd apps/tauri
npm run tauri build
```

## 项目结构

```text
.
├── apps/
│   └── tauri/          # Tauri 应用（Rust + 前端）
├── engine/
│   └── go/             # Go 核心引擎
│       ├── cmd/        # 主程序入口
│       ├── internal/   # 内部包
│       └── pkg/        # 公开包
├── docs/               # 文档
└── README.md
```

## 功能说明

### 支持的敏感信息类型

- 手机号（中国）
- 邮箱地址
- 身份证号（中国居民身份证）
- IP 地址（IPv4）
- 域名/URL
- Token/Key（API Key、Bearer Token、JWT、Cookie）
- 密码字段
- 私钥片段（PEM 格式）

### 清洗策略

- **Mask**：部分打码（保留少量前后缀）
- **Redact**：替换成占位符 `[REDACTED:TYPE]`
- **Pseudonym**：一致化替换（同一实体全文保持同一代号）

### 清洗强度

- **宽松**：只识别明显的高风险内容
- **标准**：平衡误报和漏报
- **严格**：尽可能识别所有可能的敏感信息

## 完整功能清单

### 📥 核心输入输出

- ✅ 支持粘贴/输入一段文本进行清洗
- ✅ 支持导入文本文件进行清洗
- ✅ 输出清洗后的文本
- ✅ 生成一份清洗报告（命中类型与数量）
- ✅ 提供清洗前后对比视图（Diff 视图）

### 🔍 敏感信息识别范围

#### PII 个人信息

- ✅ 手机号（中国手机号，含校验）
- ✅ 邮箱地址
- ✅ 身份证号/护照号（含校验位验证）
- ✅ 住址信息
- ✅ 姓名（可选，默认宽松避免误伤）
- ✅ 车牌号
- ✅ 生日/日期信息

#### 账号与密钥

- ✅ API Key（常见前缀：sk-、AKIA、ghp_ 等）
- ✅ Access Token / Bearer Token
- ✅ JWT（JSON Web Token）
- ✅ Cookie 信息
- ✅ SSH Key / 私钥片段（PEM 格式）
- ✅ 密码字段与口令内容（上下文辅助检测）

#### 金融信息

- ✅ 银行卡号（含 Luhn 校验）
- ✅ 交易流水号
- ✅ 工资信息
- ✅ 报销单号

#### 组织/业务机密

- ✅ 内部域名
- ✅ 工号/员工编号
- ✅ 客户名单/联系人信息（名单式敏感）
- ✅ 合同编号
- ✅ 项目代号
- ✅ 服务器 IP / 内网段

#### 位置与轨迹

- ✅ 精确定位（GPS 坐标）
- ✅ 家庭/公司地址
- ✅ 行程安排

#### 特殊类别（可选，默认更严格）

- ⚙️ 医疗信息（可选开关）
- ⚙️ 未成年人相关信息（可选开关）

### 🛠️ 清洗与替换方式

- ✅ **打码式处理**（Mask）：部分隐藏，如 `138****1234`
- ✅ **整段替换**（Redact）：替换为占位符，如 `[REDACTED:PHONE]`
- ✅ **一致化替换**（Pseudonymize）：同一对象全篇保持同一代号，如 `张三 → [PERSON_1]`
- ✅ **保留部分信息**：用于可读性，例如仅保留后四位
- ⚙️ **仅标注模式**：只标注不替换（用于审核场景）

### ⚙️ 可控与可配置

- ✅ 清洗强度等级（宽松/标准/严格）
- ✅ 按类别开关（比如只清 token，不清手机号）
- ✅ 自定义敏感类别与命名
- ✅ 添加自定义规则（正则表达式）
- ✅ **白名单**（Allowlist）：不清洗某些内容（如测试手机号、示例邮箱）
- ✅ **黑名单**（Denylist）：强制清洗某些内容（如公司内部编号规则）

### 👀 交互与审阅

- ⚙️ **逐条确认替换**（Review Mode）：人工审核模式，对高风险场景很重要
- ✅ **一键撤销清洗**：别让用户因为一次清洗把原文弄丢
- ⚙️ **仅恢复某一类替换**：选择性回滚
- ⚙️ **误报标记**：对某条命中标记为误报并忽略

### 📊 风险提示与评分

- ✅ 整体文本风险等级提示（0-100 分）
- ✅ **高危内容单独提示**：密钥、私钥、密码等高危类型单独标记
- ✅ 每类敏感信息的风险权重显示（用于解释评分）

### 📄 多格式与场景适配

- ✅ Markdown 文本清洗（保留格式）
- ✅ 代码片段内容清洗（避免误判代码变量名）
- ✅ JSON 内容清洗（只替换值，不破坏格式）
- ✅ YAML 内容清洗（保留结构）
- ✅ 保留原有排版与结构（输出不乱）

### 🚀 使用形态

- ✅ **桌面应用**（Tauri）：开箱即用，适合日常用户
- ✅ **命令行工具**（CLI）：最通用，适合开发者
- ⚙️ **SDK**：可嵌入到别的应用（Python/JS）
- ⚙️ **浏览器扩展**：复制粘贴前自动扫描（杀伤力巨大）
- ⚙️ **IDE 插件**：在写 Prompt 的地方提醒（Cursor/VS Code）

### 👥 团队与工程化（加分项）

- ⚙️ 批量处理多个文件
- ⚙️ 生成汇总报告（项目级统计）
- ⚙️ Git pre-commit hook：防止把 prompt 文件里的敏感信息提交上去
- ⚙️ GitHub Action：PR 扫描（对团队特别有吸引力）
- ⚙️ Webhook/HTTP API（可选）：给别的工具调用

### 📚 文档与体验

- ✅ 清晰的使用说明与示例
- ⚙️ 常见误报场景说明
- ⚙️ "我能做什么/我做不到什么"的声明
- ⚙️ 一套匿名示例数据用于演示

### 🔐 安全与信任

- ✅ **本地优先**：默认离线运行，不把文本上传到任何地方
- ✅ **确定性**：同样输入同样输出（方便审计）
- ✅ **不记录原文**：日志只记录统计，不落全文
- ✅ **敏感输出保护**：报告里也不把原始密钥打印出来（最多显示前后几位）
- ⚙️ 配置可加密（加分）：例如保存 allowlist/映射表时可选加密
- ⚙️ 威胁模型说明：README 写清楚防什么、不防什么

### 🎯 进阶功能（未来野心）

- 🔮 **语义级去标识**：北京市海淀区XX小区 → 北京市某城区某小区
- 🔮 **角色替换**：王经理 → 某管理人员
- 🔮 **保留任务可用性**：清洗后还能让模型完成工作，而不是变成 [REDACTED] 大杂烩

> 💡 **图例说明**：
>
> - ✅ 已实现或计划实现的核心功能
> - ⚙️ 加分功能（计划中）
> - 🔮 进阶功能（未来野心）

## 协议文档

详细的通信协议请参考 [docs/protocol.md](docs/protocol.md)

## 隐私与安全

- 所有处理完全在本地进行
- 不记录原文到日志
- 报告中的敏感内容仅显示掩码预览
- 不发送任何网络请求（除非明确启用未来可能的 LLM 增强模式）

## 许可证

MIT License

## 贡献指南

欢迎贡献！请查看 [docs/contributing.md](docs/contributing.md) 了解详细信息。

## 路线图

### Phase 1: MVP 核心功能 ✅

- [x] 规则检测 + 校验（手机号、身份证校验位、银行卡 Luhn）
- [x] Secret 扫描（高熵字符串检测 + 常见 Key 前缀）
- [x] 三种替换策略（Mask / Redact / Pseudonymize）
- [x] 清洗报告 + Diff 视图
- [x] 基础配置（强度级别、类别开关）

### Phase 2: 可控性与可解释性 🚧

- [ ] Allowlist / Denylist 机制
- [ ] 自定义规则包
- [ ] Review Mode（逐条确认替换）
- [ ] 风险评分系统
- [ ] 误报管理（规则命名 + 规则开关）

### Phase 3: 多格式与场景适配 📋

- [ ] Markdown / JSON / YAML 结构化处理
- [ ] 代码友好检测（避免误判变量名）
- [ ] 保留结构输出

### Phase 4: 生态与集成 🌐

- [ ] CLI 工具
- [ ] SDK（Python/JS）
- [ ] 浏览器扩展
- [ ] IDE 插件（Cursor/VS Code）
- [ ] Git pre-commit hook
- [ ] GitHub Action

### Phase 5: 进阶功能 🔮

- [ ] 批量文件处理
- [ ] 项目级汇总报告
- [ ] 语义级去标识（可选插件）
- [ ] LLM 增强模式（可选，默认关闭）

> 💡 当前进度：Phase 1 已完成，正在推进 Phase 2
